cmake_minimum_required(VERSION 3.10)

include(${CMAKE_CURRENT_LIST_DIR}/../cmake/common.cmake)

option(IOHUB_PLATFORM "Select the IOHUB platform")

# Require user to define IOHUB_PLATFORM
if(NOT IOHUB_PLATFORM OR IOHUB_PLATFORM STREQUAL "")
    message(FATAL_ERROR "You must define IOHUB_PLATFORM (e.g. -DIOHUB_PLATFORM=ESP32, ARDUINO, RPI, MPSSE)")
endif()

message(STATUS "Building libiohub for platform: ${IOHUB_PLATFORM}")

# Get platform sources and create library
get_iohub_sources(${CMAKE_CURRENT_LIST_DIR}/.. ${IOHUB_PLATFORM} IOHUB_SOURCES)
add_library(iohub STATIC ${IOHUB_SOURCES})

# Configure target
target_include_directories(iohub PUBLIC ${CMAKE_CURRENT_SOURCE_DIR}/../include)
configure_iohub_target(iohub ${IOHUB_PLATFORM})

# Link mpsse library only for MPSSE platform
if(IOHUB_PLATFORM STREQUAL "MPSSE")
    target_link_libraries(iohub PUBLIC mpsse)
endif()
